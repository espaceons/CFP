{% extends 'base.html' %}
{% block title %}
  D√©tail de la session : {{ session.nom_session }}
{% endblock %}

{% block content %}
  <div class="container mt-4">
    {# Titre de la page #}
    <h1 class="mb-3">D√©tail de la session</h1>
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">Informations Cl√©s</div>
      <div class="card-body">
        <p>
          <strong>Formation Associ√©e :</strong> {{ session.formation.nom }}
        </p>
        <p>
          <strong>Statut Actuel :</strong> {{ session.statut }}
        </p>

        {# ---------------------------------------------------- #}
        {# üõë AJOUT DES DATES üõë #}
        <p>
          <strong>Date de D√©but :</strong>
          {# Le filtre date:'d F Y' formate la date en "24 octobre 2025" #}
          {{ session.date_debut_session|date:'d F Y' }}
        </p>
        <p>
          <strong>Date de Fin :</strong>
          {{ session.date_fin_session|date:'d F Y' }}
        </p>
        {# ---------------------------------------------------- #}

        <p>
          <strong>Lieu Principal :</strong> {{ session.lieu }}
        </p>
        <p>
          <strong>Capacit√© Max :</strong> {{ session.capacite_max }}
        </p>
        {# ... autres champs ... #}
      </div>
    </div>

    {% comment %} {# Carte Bootstrap pour les informations principales de la session #} {% endcomment %}
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">
        <div class="d-flex justify-content-between align-items-center">
          <h4>Informations de la session : "{{ session.nom_session }}"</h4>
          {% comment %} {# Liens pour modifier ou supprimer la session #} {% endcomment %}
          <div>
            <a href="{% url 'gestion_formations:session_update' pk=session.pk %}" class="btn btn-sm btn-light me-2">Modifier la session</a>
            <a href="{% url 'gestion_formations:session_delete' pk=session.pk %}" class="btn btn-sm btn-danger" onclick="return confirm('Confirmer la suppression de cette session ?');">Supprimer la session</a>
          </div>
        </div>
      </div>
      <div class="card-body">
        <p>
          <strong>Formation associ√©e :</strong> {{ session.formation.nom }}
        </p>
        <p>
          <strong>Statut :</strong>
          <span class="badge {% if session.statut == 'IN_PROGRESS' %}
              
            
              bg-success


            {% elif session.statut == 'COMPLETED' %}
              
            
              bg-secondary


            {% elif session.statut == 'CANCELLED' %}
              
          
              bg-danger


            {% else %}
              

                            
              bg-warning


            {% endif %}">
            {{ session.get_statut_display }}
          </span>
        </p>
        <p>
          <strong>P√©riode :</strong> Du {{ session.date_debut_session|date:'d/m/Y' }} au {{ session.date_fin_session|date:'d/m/Y' }}
        </p>
        <p>
          <strong>Capacit√© :</strong> {{ session.capacite_min|default:'N/A' }} -
          {{ session.capacite_max }} places
        </p>
        {% comment %} {# Affichage du formateur principal (suppose Instructor li√© √† CustomUser
      via champ 'user') #} {% endcomment %}
        <p>
          <strong>Formateur principal :</strong>
          {% if session.instructor_principal and session.instructor_principal.user %}
            {{ session.instructor_principal.user.get_full_name|default:session.instructor_principal.user.username }}
          {% else %}
            Non attribu√©
          {% endif %}
        </p>
        <p>
          <strong>Lieu principal :</strong> {{ session.lieu|default:'Non sp√©cifi√©' }}
        </p>

        {% if session.description %}
          <h5>Description :</h5>
          <p>{{ session.description|linebreaksbr }}</p>
        {% endif %}
      </div>
    </div>

    <hr />
    {% comment %} {# S√©parateur #} {# Section pour les s√©ances de la session #} {% endcomment %}
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>S√©ances planifi√©es pour cette session</h2>
      {% comment %} {# Liens pour ajouter des s√©ances #} {% endcomment %}
      <div>
        <a href="{% url 'gestion_formations:seance_create' session_pk=session.pk %}" class="btn btn-primary me-2">Ajouter une s√©ance</a>
        <a href="{% url 'gestion_formations:seance_create_multiple' session_pk=session.pk %}" class="btn btn-info">Ajouter plusieurs s√©ances</a>
      </div>
    </div>

    {% comment %} {# Liste des s√©ances existantes #} {% endcomment %}
    {% if seances %}
      <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle">
          <thead class="table-dark">
            <tr>
              <th>Date</th>
              <th>Heure d√©but</th>
              <th>Heure fin</th>
              <th>Sujet</th>
              <th>Formateur</th>
              <th>Lieu</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for seance in seances %}
              <tr>
                <td>{{ seance.date|date:'d/m/Y' }}</td>
                <td>{{ seance.heure_debut|time:'H:i' }}</td>
                <td>{{ seance.heure_fin|time:'H:i' }}</td>
                <td>{{ seance.sujet_aborde|default:'-' }}</td>
                {% comment %} {# Affichage du formateur de la s√©ance (prioritaire) ou du formateur
          principal de la session #} {% endcomment %}
                <td>
                  {% if seance.instructor and seance.instructor.user %}
                    {{ seance.instructor.user.get_full_name|default:seance.instructor.user.username }}
                  {% elif seance.session.instructor_principal and seance.session.instructor_principal.user %}
                    {{ seance.session.instructor_principal.user.get_full_name|default:seance.session.instructor_principal.user.username }} (Formateur principal)
                  {% else %}
                    Non assign√©
                  {% endif %}
                </td>
                {% comment %} {# Utilise le lieu sp√©cifique de la s√©ance s'il existe, sinon le lieu
          principal de la session #} {% endcomment %}
                <td>{{ seance.lieu_seance|default:seance.session.lieu|default:'-' }}</td>
                <td>
                  <span class="badge {% if seance.est_annulee %}
                      
                        
                      bg-danger


                    {% else %}
                      
 
                      bg-success


                    {% endif %}">
                    {% if seance.est_annulee %}
                      Annul√©e
                    {% else %}
                      Active
                    {% endif %}
                  </span>
                </td>
                <td>
                  {% comment %} {# Liens vers d√©tail et modification de la S√âANCE #} {# Assurez-vous
            d'utiliser session_pk et pk #} {% endcomment %}
                  <a href="{% url 'gestion_formations:seance_detail' session_pk=session.pk pk=seance.pk %}" class="btn btn-primary btn-sm">D√©tail</a>
                  <a href="{% url 'gestion_formations:seance_update' session_pk=seance.session.pk pk=seance.pk %}" class="btn btn-warning btn-sm">Modifier</a>
                  <a href="{% url 'gestion_formations:seance_delete' session_pk=seance.session.pk pk=seance.pk %}" class="btn btn-sm btn-danger" onclick="return confirm('Confirmer la suppression de cette s√©ance ?');">Supprimer</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted">Aucune s√©ance n'est encore planifi√©e pour cette session.</p>
    {% endif %}

    <hr />
    {% comment %} {# S√©parateur #} {# Lien de retour vers la liste des sessions #} {% endcomment %}
    <div class="mt-3">
      <a href="{% url 'gestion_formations:session_list' %}" class="btn btn-secondary">Retour √† la liste des sessions</a>
      {% comment %} {# Optionnel : Lien retour vers la formation si la session est li√©e √† une
    formation sp√©cifique dans l'URL #} {% endcomment %}
      <a href="{% url 'gestion_formations:formation_detail' pk=session.formation.pk %}" class="btn btn-secondary ms-2">Voir la formation associ√©e</a>
    </div>
  </div>
{% endblock %}
